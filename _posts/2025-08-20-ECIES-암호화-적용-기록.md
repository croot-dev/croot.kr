---
layout: post
title: "ECIES μ•”νΈν™” μ μ© κΈ°λ΅"
created: 2025-08-20
edited: 2025-08-29
category: [κΈ°μ ]
tags: []
---


## Prologue


κ·Έλ¦¬μ¤ λ‚΄ κµν†µμ‹μ¤ν… ν”„λ΅μ νΈλ¥Ό μ§„ν–‰ν•λ©΄μ„ **AMKA, Passport** λ“± λ―Όκ°ν• κ°μΈμ •λ³΄λ¥Ό μ…λ ¥λ°›μ•„ μ „μ†΅ν•΄μ•Ό ν•λ” κΈ°λ¥μ΄ ν•„μ”


μ΄κΈ°μ—λ” RSAμ™€ ECC μ¤‘ κ³ λ―Όν–μΌλ‚, λ³΄λ‹¤ **κ°€λ²Όμ΄ ECC**λ¥Ό μ‚¬μ©ν•κΈ°λ΅ κ²°μ •ν•¨.


### λ³΄μ• μ”κµ¬μ‚¬ν•­ (ν•μ΄λΈλ¦¬λ“ μ•”νΈν™”)

1. **μ„λ²„**μ—μ„ λΉ„λ€μΉ­ ν‚¤μ(κ³µκ°ν‚¤/κ°μΈν‚¤) μƒμ„±
2. **κ³µκ°ν‚¤**λ¥Ό APIλ΅ **ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬**
3. ν΄λΌμ΄μ–ΈνΈλ” λ€μΉ­ν‚¤(AES λ“±)λ¥Ό μƒμ„±ν•΄ **νΌ λ°μ΄ν„° μ•”νΈν™”**
4. **λ€μΉ­ν‚¤λ¥Ό κ³µκ°ν‚¤λ΅ μ•”νΈν™”**
5. **μ•”νΈν™”λ λ°μ΄ν„° + μ•”νΈν™”λ λ€μΉ­ν‚¤λ¥Ό μ„λ²„λ΅ μ „μ†΅**
6. μ„λ²„λ” **κ°μΈν‚¤λ΅ λ€μΉ­ν‚¤ λ³µνΈν™”**, μ΄ν›„ **λ°μ΄ν„° λ³µνΈν™” λ° μ²λ¦¬**

π‘‰ ECC κΈ°λ° μ•”νΈν™” λ°©μ‹ μ¤‘ **ECIES(Integrated Encryption Scheme)** λ¥Ό μ΄μ©ν•κΈ°λ΅ κ²°μ •.


μ²μμ—λ” ECIES μμ²΄κ°€ ν•μ΄λΈλ¦¬λ“ μ•”νΈν™” λ°©μ‹μΈμ§€ λ°λμβ€¦ μμ‚¬μ†ν†µμ„ μ›ν™ν ν•κΈ° μ„ν•΄ κΈ°λ³Έμ μΈ μ •μλ¥Ό μ°μ„  ν•™μµν•¨.


### ECC κΈ°λ° μ•”νΈν™” μ ν•

- **ECDSA (Elliptic Curve Digital Signature Algorithm)**
	- **μ„¤λ…**: λ””μ§€ν„Έ μ„λ… μƒμ„± λ° κ²€μ¦μ— μ‚¬μ© β†’ λ°μ΄ν„° λ¬΄κ²°μ„±κ³Ό μΈμ¦ λ³΄μ¥
	- **νΉμ§•**: RSAλ³΄λ‹¤ μ§§μ€ ν‚¤ κΈΈμ΄λ΅ λ™μΌ λ³΄μ• μμ¤€ μ κ³µ
	- **μ©λ„**: λΈ”λ΅μ²΄μΈ(λΉ„νΈμ½”μΈ, μ΄λ”λ¦¬μ›€), μ†ν”„νΈμ›¨μ–΄ μ„λ…, μΈμ¦μ„
- **ECDH (Elliptic Curve Diffie-Hellman)**
	- **μ„¤λ…**: λ‘ λ‹Ήμ‚¬μ κ°„ μ•μ „ν• ν‚¤ κµν™ ν”„λ΅ν† μ½
	- **νΉμ§•**: λΉ„λ°€ν‚¤λ¥Ό μ§μ ‘ κµν™ν•μ§€ μ•κ³  μ•μ „ν•κ² κ³µμ  κ°€λ¥
	- **μ©λ„**: TLS/SSL, VPN, μ•”νΈν™” ν†µμ‹ 
- **ECIES (Elliptic Curve Integrated Encryption Scheme)**
	- **μ„¤λ…**: κ³µκ°ν‚¤ μ•”νΈν™” + λ€μΉ­ν‚¤ μ•”νΈν™”λ¥Ό κ²°ν•©ν• ν•μ΄λΈλ¦¬λ“ λ°©μ‹
	- **νΉμ§•**: κ³µκ°ν‚¤λ΅ λ€μΉ­ν‚¤ μ•”νΈν™” + λ°μ΄ν„°λ” λ€μΉ­ν‚¤λ΅ μ•”νΈν™”
	- **μ©λ„**: λ°μ΄ν„° μ•”νΈν™”, μ•μ „ν• λ©”μ‹μ§€ μ „μ†΅

---


# κµ¬ν„ κ³Όμ •


## λΌμ΄λΈλ¬λ¦¬ μ μ©

- **Server (Java)** β†’ [BouncyCastle λΌμ΄λΈλ¬λ¦¬](https://downloads.bouncycastle.org/java/docs/bcprov-jdk15to18-javadoc/index.html?org%2Fbouncycastle%2Fjcajce%2Fprovider%2Fasymmetric%2Fec%2FIESCipher.ECIES.html=) μ‚¬μ©
- **Client (Vue)** β†’ [eciesjs λΌμ΄λΈλ¬λ¦¬](https://github.com/ecies/js) μ‚¬μ©

λΌμ΄λΈλ¬λ¦¬λ¥Ό μ΄μ©ν•μ—¬ λΉ λ¥΄κ² ν•΄κ²°ν•λ„λ΅ μ‹λ„.


ν•μ§€λ§β€¦ λΌμ΄λΈλ¬λ¦¬λ§λ‹¤ **κ³„μ‚° λ°©μ‹, KDF, MAC μ²λ¦¬**κ°€ λ‹¬λΌ **νΈν™λμ§€ μ•λ” λ¬Έμ ** λ°μƒ!


μƒμ„Έ μµμ…μ„ μ΄μ©ν•΄λ³ΌκΉ μ‹¶μ—μ§€λ§ λΌμ΄λΈλ¬λ¦¬ BouncyCastle μ μ•”νΈν™” λ°©μ‹μ΄ λ„λ¬΄ λ³µμ΅ν•μ—¬ μ§μ ‘ μ•”λ³µνΈν™” λ΅μ§μ„ μ‘μ„±ν•κΈ°λ΅ ν•¨.


## μ•”νΈν™” μ•κ³ λ¦¬μ¦ λ¶„μ„

- **Server (Java)** β†’ Cipher μ΄μ©
- **Client (Vue)** β†’ Web Crypto API μ΄μ”

### ECIES κµ¬μ„±

- **ν‚¤ ν•©μ (ECDH)**
	- μ†΅μ‹ μμ™€ μμ‹ μμ ν‚¤λ¥Ό μ΄μ©ν•΄ **κ³µμ  λΉ„λ°€ν‚¤(Shared Secret)** μƒμ„±
- **ν‚¤ λ„μ¶ ν•¨μ (KDF)**
	- κ³µμ  λΉ„λ°€ν‚¤λ¥Ό κΈ°λ°μΌλ΅
		- `EncKey` (λ€μΉ­ν‚¤ μ•”νΈν™”μ©)
		- `MacKey` (λ¬΄κ²°μ„± κ²€μ¦μ©)

			μ„ μƒμ„±

- **λ€μΉ­ν‚¤ μ•”νΈν™” (AES λ“±)**
	- `EncKey`λ΅ μ‹¤μ  ν‰λ¬Έ λ°μ΄ν„°λ¥Ό μ•”νΈν™” β†’ Ciphertext
- **λ¬΄κ²°μ„± κ²€μ¦ (MAC)**
	- `MacKey`λ¥Ό μ΄μ©ν•΄ Ciphertextμ— λ€ν• **HMAC** μƒμ„±
	- λ°μ΄ν„° μ„Β·λ³€μ΅° μ—¬λ¶€ ν™•μΈ

### **ECIES νλ¦„**


![0](/assets/img/2025-08-20-ECIES-μ•”νΈν™”-μ μ©-κΈ°λ΅.md/0.png)_image.png_

1. **μ†΅μ‹ μ**
	- μμ‹ μμ κ³µκ°ν‚¤λ΅ ECDH μν–‰ β†’ Shared Secret
	- Shared Secretμ„ KDFλ΅ μ²λ¦¬ β†’ `EncKey`, `MacKey`
	- `EncKey`λ΅ λ©”μ‹μ§€ λ€μΉ­ μ•”νΈν™” (AES)
	- `MacKey`λ΅ HMAC μƒμ„±
	- μµμΆ…μ μΌλ΅: `Ciphertext + HMAC + μ†΅μ‹ μ κ³µκ°ν‚¤` μ „μ†΅
2. **μμ‹ μ**
	- μ†΅μ‹ μμ κ³µκ°ν‚¤ + μμ‹ μ κ°μΈν‚¤λ΅ ECDH μν–‰ β†’ λ™μΌν• Shared Secret
	- λ™μΌν• KDF μν–‰ β†’ `EncKey`, `MacKey`
	- HMAC κ²€μ¦ β†’ λ©”μ‹μ§€ λ¬΄κ²°μ„± ν™•μΈ
	- `EncKey`λ΅ μ•”νΈλ¬Έ λ³µνΈν™”

---


## κµ¬ν„


```javascript
nuxt + typescript μ»΄ν¬μ €λΈ” μƒμ„±

1. base64 ν•νƒμ server public key string, form object, μ•”νΈν™” λ€μƒ fieldλ… λ°°μ—΄μ„ μ…λ ¥λ°›μ
1. form fieldλ” AES/CBC/PKCS5Padding  μ•”νΈν™” μ•κ³ λ¦¬μ¦ μ΄μ©ν•μ—¬ μ•”νΈν™”
1. AES Keyμ™€ ivλ” EC/secp256r1, ECIES μ•”νΈν™” μ•κ³ λ¦¬μ¦ μ΄μ©ν•μ—¬ λ§λ“¤μ–΄μ§„ server public keyλ¥Ό μ΄μ©ν•μ—¬ μ•”νΈν™”
1. java BouncyCastleProvider κ³Ό νΈν™ λμ–΄μ•Όν•  κ²ƒ
1. μ¶λ ¥μ€ μ•”νΈν™”λ form object, μ•”νΈν™” λ aes key base64, μ•”νΈν™” λ iv base64κ°€ λ‚μ™€μ•Ό ν•¨
1. salt, info, wrap λ“± ν•„μμ μ΄μ§€ μ•μ€ λ΅μ§μ€ λ¨λ‘ μ κ±°
```


### μµμΆ… κ²°μ • μ•”νΈν™” λ°©μ‹


**ECIES**

- Curve : `secp256r1`
- Point Encoding: `? (Uncompressed | Compressed | Hybrid)`
- KDF: `KDF2 with SHA-256`
- λ€μΉ­μ•”νΈν™”: `AES-256-CBC`

**AES**

- Mode: `AES-256-CBC`
- IV: `Random`
- Padding: `PKCS5Padding` (PKCS7Padding νΈν™)
- MAC: `HMAC-SHA256`

---


### Design


![1](/assets/img/2025-08-20-ECIES-μ•”νΈν™”-μ μ©-κΈ°λ΅.md/1.png)_image.png_


### μ†μ¤μ½”λ“


Server


```java
// Empty
```


Client


```javascript
// Empty
```


## λ¦¬ν©ν† λ§


κΈ°μ΅΄μ—λ” Form data μ•”νΈν™”μ™€ ECIES λ‚΄λ¶€ μ•”νΈν™” λ°©μ‹μ΄ μƒμ΄ν•κ² κ°λ°λμ—μ.


Form data μ•”νΈν™”μ— μ‚¬μ©λλ” λ€μΉ­ μ•”νΈν™”λ¥Ό ECIES λ‚΄λ¶€μ—μ„λ„ λ™μΌν•κ² μ‚¬μ©ν•κ²λ” κ°μ„ 


Server


```java
// Empty
```


Client


```javascript
// EMPTY
```


---


# Epilogue


ν•΄λ‹Ή μ—…λ¬΄λ¥Ό μ§„ν–‰ν•λ©° κ³Όκ±°μ— μ•„λ¬΄κ²ƒλ„ λ¨λ¥΄κ³  κ·Έλƒ¥ λ¬΄μ‘μ • μ•”κΈ°ν–λ μ•…λ½κ°™μ€ κΈ°μ λ“¤μ΄ μƒλ΅μƒλ΅ κΈ°μ–µλ‚λ©΄μ„ κµ‰μ¥ν μ‹ μ„ ν–μ.


Buffer μ²λ¦¬λ‚ Web Crypto API ν•Έλ“¤λ§λ„ μΆ€ λ” λ¥μ™ν•΄μ΅κ³ , κΈ°λ³Έμ μΈ μ•”νΈν™” κµ¬μ΅°λ‚ κ°λ…λ“¤κ³Όλ„ μΆ€ λ” μΉν•΄μ§„ κ²ƒ κ°™μ.


ν”Όμ™€ μ‚΄μ΄ λλ” κ²½ν—μ΄μ€λ κ²ƒ κ°™μβ€¦


# μ°Έκ³ 


κµ¬ν„ Design sequence diagram


[file](https://prod-files-secure.s3.us-west-2.amazonaws.com/8daffe33-d95b-4c96-91e6-1b899bcdb2d7/a7e5a59a-ccb0-41b0-b7cf-f894674cfbf3/%E1%84%8C%E1%85%A6%E1%84%86%E1%85%A9%E1%86%A8_%E1%84%8B%E1%85%A5%E1%86%B9%E1%84%82%E1%85%B3%E1%86%AB_%E1%84%83%E1%85%A1%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%A5%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%86%B7.drawio?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UKVYUBA5%2F20251027%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20251027T141154Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEO7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQD8lt1vxy9RO4p2Mb75%2FGoKqNRTH8oJ5a%2BPkotkzIfxQgIgfxWTbDrTPtfXJakU1uLTbdcT0JeZpgaRJuiEDDQdZbgqiAQIp%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDA6srNLmuycKPFhrqSrcAyfFHWIG2u3SUc92IWvIg1aBRiyzQ%2FHCKCq1F2IYlNi%2BrPUSrXGDSYkot4laPQ4j02dSJra1KDVKezxfuqZ1Qgjgl7u9uxQuzDz9hsH8qSmaZwayUimnHsFimeId6S02ZpatF5YnI5PasI6jiTSS8XskBfmHBH8zdO70RwelJUbZBgoLv9wUVba6gEY%2BNnWOfxRh%2Fe44XuNbrH8buw5TZInYqdOZHIEmIbJHqVCUTzXjvjDVlMkruzZH19XN9wC7%2F088TVPZJ6tI%2BVWEwy36swtpPofDOly27SiLtHOa6IRhX7QZxMdDih0pdX2a%2Bca5LcKvBXUi9uot5ytcmR%2FFgYWxXvuK0PfgZjsUMLUQpTmWtA2Chtsb%2Bw6dBjaNGiIHMDymShdshZZHkx8H6kJOVLwcoYHe5T7JKW2YOHigKZ2S1IAreVJNwBAstWyyr9Ohroosx3OE5qpqVQXfBOLOUrx2taQ1HwYXaibo8e9un9bsXJm6ATJFlSF8yBDc3ktVoSl93pQH%2B2eB%2B%2B8G3ZdTDa0WVx3ci0jBx21UZCApjHKIaIhJDBlkp89I7fnBQF1G1Ma6emcPoY7DilDPP4HA6e4u9iIT6vOLLMbMitogtu7QUOWu%2BasxQ1lbB7MyMO%2Fv%2FccGOqUBg7zSMagXrYDISc9jO7hPN5JArgXvMoOoWINCzavCgIjblurVYZdwJEeJUTjz5X0sF63O69kYoSMK1mJc1CovGVn86Y7mzajxJ%2BGCzmfpxL9vmjGUa%2FyAdb6oKvtkU%2BqpsQJKg2VoBtq9g1VHpj8uqDXDTYenLWHZJOOzvXe7LEK%2FRY8h699Ng8u4kzyH7vm25YcvZInKXo8g9jZw3vUzDt%2FeBZMX&X-Amz-Signature=cd0e85da561bdf91429ed261cf3f6d4c49342882a458e28fcd555287f21605f6&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

