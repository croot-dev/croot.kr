<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ECIES μ•”νΈν™” μ μ© κΈ°λ΅ - Croot Blog</title>
  <meta name="description" content="Prologue">
  <link href='https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto:300,400,900,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/%EA%B8%B0%EC%88%A0/2025/08/20/ECIES-%EC%95%94%ED%98%B8%ED%99%94-%EC%A0%81%EC%9A%A9-%EA%B8%B0%EB%A1%9D/">
  <link rel="alternate" type="application/rss+xml" title="Croot Blog" href="http://localhost:4000/feed.xml">
</head>

  <body>
    <aside class="c-page__searchbox">
  <div class="search">
    <input id="search-input" 
      type="search" 
      tabindex="1" 
      spellcheck="false" 
      placeholder="κ²€μƒ‰μ–΄"
    />
  </div>

  <ul id="results-container"></ul>
</aside>

<script src="/assets//script/simple-jekyll-search.min.js"></script>
<script type="text/javascript">
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/assets/json/search.json',
    noResultText: 'κ²€μƒ‰κ²°κ³Όκ°€ μ—†μµλ‹λ‹¤.',
    limit: 1000,
    fuzzy: false
  })
</script>

    <main class="u-container">
      <div class="c-page">
  <header class="c-page__header">
  <h1><code>Croot Blog</code></h1>
  
  <p>
    <a href="/">Home</a>
    <span class="u-separate"></span>
    <a href="/about/">About</a>
    <span class="u-separate"></span>
    <a href="/tech/">Tech</a>
    <span class="u-separate"></span>
    <a href="/hobby/">Hobby</a>
    <span class="u-separate"></span>
    <a href="/archive/">Archive</a>
  </p>
</header>

  <div class="c-page__main">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '\\[', right: '\\]', display: true}
          ],
          throwOnError : false
        });
    });
</script>

<div>

<div style="display:flex;flex-direction:row;background:#efefef;padding: 1.2em 1.5em;">
  <span style="width:70px;font-size:2.8em">β οΈ</span>
  <p style="flex:1;font-size:1.2em;line-height: 1.5;word-break: keep-all;">
    <span>μ΄ λΈ”λ΅κ·Έμ λ¨λ“  ν¬μ¤νΈλ” Notion λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μλ™ λ³€ν™ν•μ—¬ μ‘μ„± λμ—μµλ‹λ‹¤.</span><br />
    <span>λ”°λΌμ„ λ¬Έμ„μ— λ”°λΌ κΉ¨μ Έ λ³΄μΌ μ μμµλ‹λ‹¤.</span><br />
    <span>λ” λ§μ€ λ‚΄μ©μ΄ κ¶κΈν•μ‹λ‹¤λ©΄ π‘€</span> <a href="https://www.notion.so/croot-dev/6c50e956396b41449b42a8e134d97c4e" target="_blank" style="margin-top:12px;z-index:1">Notion λ³΄λ¬κ°€κΈ°</a>
  </p>
</div>

</div>

<article class="c-article">
  <header class="c-article__header">
    <h1 class="c-article__title">ECIES μ•”νΈν™” μ μ© κΈ°λ΅</h1>
    <!-- <p class="c-article__time"><time datetime="2025-08-20T00:00:00+09:00" itemprop="datePublished">Aug 20, 2025</time></p> -->
  </header>

  <div class="c-article__info">
    <table>
      <tbody>
        <tr>
          <th>μ‘μ„±μΌ</th><td>2025λ…„ 08μ›” 20μΌ</td>
        </tr>
        <tr>
          <th>μμ •μΌ</th><td>2025λ…„ 12μ›” 31μΌ</td>
        </tr>
        <tr>
          <th>μΉ΄ν…κ³ λ¦¬</th><td>κΈ°μ </td>
        </tr>
        <tr>
          <th>νƒκ·Έ</th><td>
            <ul class="c-tags">
              
              
              <li class="c-tag" style="background:rgb(253 236 200);color:rgb(64 44 27)">Security</li>
              
            </ul>
          </td>
        </tr>
        
        <tr>
          <th>μ›λ³Έ</th><td><a href="https://croot.notion.site/2556063e6590801093d2d0a0d66cebf2" target="_blank" rel="noopener noreferrer">https://croot.notion.site/2556063e6590801093d2d0a0d66cebf2</a></td>
        </tr>
        
      </tbody>
    </table>
  </div>

  <div class="c-article__main">
    <h2 id="prologue">Prologue</h2>

<p>κ·Έλ¦¬μ¤ λ‚΄ κµν†µμ‹μ¤ν… ν”„λ΅μ νΈλ¥Ό μ§„ν–‰ν•λ©΄μ„ <strong>AMKA, Passport</strong> λ“± λ―Όκ°ν• κ°μΈμ •λ³΄λ¥Ό μ…λ ¥λ°›μ•„ μ „μ†΅ν•΄μ•Ό ν•λ” κΈ°λ¥μ΄ ν•„μ”</p>

<p>μ΄κΈ°μ—λ” RSAμ™€ ECC μ¤‘ κ³ λ―Όν–μΌλ‚, λ³΄λ‹¤ <strong>κ°€λ²Όμ΄ ECC</strong>λ¥Ό μ‚¬μ©ν•κΈ°λ΅ κ²°μ •ν•¨.</p>

<h3 id="λ³΄μ•-μ”κµ¬μ‚¬ν•­-ν•μ΄λΈλ¦¬λ“-μ•”νΈν™”">λ³΄μ• μ”κµ¬μ‚¬ν•­ (ν•μ΄λΈλ¦¬λ“ μ•”νΈν™”)</h3>

<ol>
  <li><strong>μ„λ²„</strong>μ—μ„ λΉ„λ€μΉ­ ν‚¤μ(κ³µκ°ν‚¤/κ°μΈν‚¤) μƒμ„±</li>
  <li><strong>κ³µκ°ν‚¤</strong>λ¥Ό APIλ΅ <strong>ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬</strong></li>
  <li>ν΄λΌμ΄μ–ΈνΈλ” λ€μΉ­ν‚¤(AES λ“±)λ¥Ό μƒμ„±ν•΄ <strong>νΌ λ°μ΄ν„° μ•”νΈν™”</strong></li>
  <li><strong>λ€μΉ­ν‚¤λ¥Ό κ³µκ°ν‚¤λ΅ μ•”νΈν™”</strong></li>
  <li><strong>μ•”νΈν™”λ λ°μ΄ν„° + μ•”νΈν™”λ λ€μΉ­ν‚¤λ¥Ό μ„λ²„λ΅ μ „μ†΅</strong></li>
  <li>μ„λ²„λ” <strong>κ°μΈν‚¤λ΅ λ€μΉ­ν‚¤ λ³µνΈν™”</strong>, μ΄ν›„ <strong>λ°μ΄ν„° λ³µνΈν™” λ° μ²λ¦¬</strong></li>
</ol>

<p>π‘‰ ECC κΈ°λ° μ•”νΈν™” λ°©μ‹ μ¤‘ <strong>ECIES(Integrated Encryption Scheme)</strong> λ¥Ό μ΄μ©ν•κΈ°λ΅ κ²°μ •.</p>

<p>μ²μμ—λ” ECIES μμ²΄κ°€ ν•μ΄λΈλ¦¬λ“ μ•”νΈν™” λ°©μ‹μΈμ§€ λ°λμβ€¦ μμ‚¬μ†ν†µμ„ μ›ν™ν ν•κΈ° μ„ν•΄ κΈ°λ³Έμ μΈ μ •μλ¥Ό μ°μ„  ν•™μµν•¨.</p>

<h3 id="ecc-κΈ°λ°-μ•”νΈν™”-μ ν•">ECC κΈ°λ° μ•”νΈν™” μ ν•</h3>

<ul>
  <li><strong>ECDSA (Elliptic Curve Digital Signature Algorithm)</strong>
    <ul>
      <li><strong>μ„¤λ…</strong>: λ””μ§€ν„Έ μ„λ… μƒμ„± λ° κ²€μ¦μ— μ‚¬μ© β†’ λ°μ΄ν„° λ¬΄κ²°μ„±κ³Ό μΈμ¦ λ³΄μ¥</li>
      <li><strong>νΉμ§•</strong>: RSAλ³΄λ‹¤ μ§§μ€ ν‚¤ κΈΈμ΄λ΅ λ™μΌ λ³΄μ• μμ¤€ μ κ³µ</li>
      <li><strong>μ©λ„</strong>: λΈ”λ΅μ²΄μΈ(λΉ„νΈμ½”μΈ, μ΄λ”λ¦¬μ›€), μ†ν”„νΈμ›¨μ–΄ μ„λ…, μΈμ¦μ„</li>
    </ul>
  </li>
  <li><strong>ECDH (Elliptic Curve Diffie-Hellman)</strong>
    <ul>
      <li><strong>μ„¤λ…</strong>: λ‘ λ‹Ήμ‚¬μ κ°„ μ•μ „ν• ν‚¤ κµν™ ν”„λ΅ν† μ½</li>
      <li><strong>νΉμ§•</strong>: λΉ„λ°€ν‚¤λ¥Ό μ§μ ‘ κµν™ν•μ§€ μ•κ³  μ•μ „ν•κ² κ³µμ  κ°€λ¥</li>
      <li><strong>μ©λ„</strong>: TLS/SSL, VPN, μ•”νΈν™” ν†µμ‹ </li>
    </ul>
  </li>
  <li><strong>ECIES (Elliptic Curve Integrated Encryption Scheme)</strong>
    <ul>
      <li><strong>μ„¤λ…</strong>: κ³µκ°ν‚¤ μ•”νΈν™” + λ€μΉ­ν‚¤ μ•”νΈν™”λ¥Ό κ²°ν•©ν• ν•μ΄λΈλ¦¬λ“ λ°©μ‹</li>
      <li><strong>νΉμ§•</strong>: κ³µκ°ν‚¤λ΅ λ€μΉ­ν‚¤ μ•”νΈν™” + λ°μ΄ν„°λ” λ€μΉ­ν‚¤λ΅ μ•”νΈν™”</li>
      <li><strong>μ©λ„</strong>: λ°μ΄ν„° μ•”νΈν™”, μ•μ „ν• λ©”μ‹μ§€ μ „μ†΅</li>
    </ul>
  </li>
</ul>

<hr />

<h1 id="κµ¬ν„-κ³Όμ •">κµ¬ν„ κ³Όμ •</h1>

<h2 id="λΌμ΄λΈλ¬λ¦¬-μ μ©">λΌμ΄λΈλ¬λ¦¬ μ μ©</h2>

<ul>
  <li><strong>Server (Java)</strong> β†’ <a href="https://downloads.bouncycastle.org/java/docs/bcprov-jdk15to18-javadoc/index.html?org%2Fbouncycastle%2Fjcajce%2Fprovider%2Fasymmetric%2Fec%2FIESCipher.ECIES.html=">BouncyCastle λΌμ΄λΈλ¬λ¦¬</a> μ‚¬μ©</li>
  <li><strong>Client (Vue)</strong> β†’ <a href="https://github.com/ecies/js">eciesjs λΌμ΄λΈλ¬λ¦¬</a> μ‚¬μ©</li>
</ul>

<p>λΌμ΄λΈλ¬λ¦¬λ¥Ό μ΄μ©ν•μ—¬ λΉ λ¥΄κ² ν•΄κ²°ν•λ„λ΅ μ‹λ„.</p>

<p>ν•μ§€λ§β€¦ λΌμ΄λΈλ¬λ¦¬λ§λ‹¤ <strong>κ³„μ‚° λ°©μ‹, KDF, MAC μ²λ¦¬</strong>κ°€ λ‹¬λΌ <strong>νΈν™λμ§€ μ•λ” λ¬Έμ </strong> λ°μƒ!</p>

<p>μƒμ„Έ μµμ…μ„ μ΄μ©ν•΄λ³ΌκΉ μ‹¶μ—μ§€λ§ λΌμ΄λΈλ¬λ¦¬ BouncyCastle μ μ•”νΈν™” λ°©μ‹μ΄ λ„λ¬΄ λ³µμ΅ν•μ—¬ μ§μ ‘ μ•”λ³µνΈν™” λ΅μ§μ„ μ‘μ„±ν•κΈ°λ΅ ν•¨.</p>

<h2 id="μ•”νΈν™”-μ•κ³ λ¦¬μ¦-λ¶„μ„">μ•”νΈν™” μ•κ³ λ¦¬μ¦ λ¶„μ„</h2>

<ul>
  <li><strong>Server (Java)</strong> β†’ Cipher μ΄μ©</li>
  <li><strong>Client (Vue)</strong> β†’ Web Crypto API μ΄μ”</li>
</ul>

<h3 id="ecies-κµ¬μ„±">ECIES κµ¬μ„±</h3>

<ul>
  <li><strong>ν‚¤ ν•©μ (ECDH)</strong>
    <ul>
      <li>μ†΅μ‹ μμ™€ μμ‹ μμ ν‚¤λ¥Ό μ΄μ©ν•΄ <strong>κ³µμ  λΉ„λ°€ν‚¤(Shared Secret)</strong> μƒμ„±</li>
    </ul>
  </li>
  <li><strong>ν‚¤ λ„μ¶ ν•¨μ (KDF)</strong>
    <ul>
      <li>κ³µμ  λΉ„λ°€ν‚¤λ¥Ό κΈ°λ°μΌλ΅
        <ul>
          <li><code class="language-plaintext highlighter-rouge">EncKey</code> (λ€μΉ­ν‚¤ μ•”νΈν™”μ©)</li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">MacKey</code> (λ¬΄κ²°μ„± κ²€μ¦μ©)</p>

            <p>μ„ μƒμ„±</p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong>λ€μΉ­ν‚¤ μ•”νΈν™” (AES λ“±)</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">EncKey</code>λ΅ μ‹¤μ  ν‰λ¬Έ λ°μ΄ν„°λ¥Ό μ•”νΈν™” β†’ Ciphertext</li>
    </ul>
  </li>
  <li><strong>λ¬΄κ²°μ„± κ²€μ¦ (MAC)</strong>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">MacKey</code>λ¥Ό μ΄μ©ν•΄ Ciphertextμ— λ€ν• <strong>HMAC</strong> μƒμ„±</li>
      <li>λ°μ΄ν„° μ„Β·λ³€μ΅° μ—¬λ¶€ ν™•μΈ</li>
    </ul>
  </li>
</ul>

<h3 id="ecies-νλ¦„"><strong>ECIES νλ¦„</strong></h3>

<p><img src="/assets/img/2025-08-20-ECIES-μ•”νΈν™”-μ μ©-κΈ°λ΅.md/0.png" alt="0" /><em>image.png</em></p>

<ol>
  <li><strong>μ†΅μ‹ μ</strong>
    <ul>
      <li>μμ‹ μμ κ³µκ°ν‚¤λ΅ ECDH μν–‰ β†’ Shared Secret</li>
      <li>Shared Secretμ„ KDFλ΅ μ²λ¦¬ β†’ <code class="language-plaintext highlighter-rouge">EncKey</code>, <code class="language-plaintext highlighter-rouge">MacKey</code></li>
      <li><code class="language-plaintext highlighter-rouge">EncKey</code>λ΅ λ©”μ‹μ§€ λ€μΉ­ μ•”νΈν™” (AES)</li>
      <li><code class="language-plaintext highlighter-rouge">MacKey</code>λ΅ HMAC μƒμ„±</li>
      <li>μµμΆ…μ μΌλ΅: <code class="language-plaintext highlighter-rouge">Ciphertext + HMAC + μ†΅μ‹ μ κ³µκ°ν‚¤</code> μ „μ†΅</li>
    </ul>
  </li>
  <li><strong>μμ‹ μ</strong>
    <ul>
      <li>μ†΅μ‹ μμ κ³µκ°ν‚¤ + μμ‹ μ κ°μΈν‚¤λ΅ ECDH μν–‰ β†’ λ™μΌν• Shared Secret</li>
      <li>λ™μΌν• KDF μν–‰ β†’ <code class="language-plaintext highlighter-rouge">EncKey</code>, <code class="language-plaintext highlighter-rouge">MacKey</code></li>
      <li>HMAC κ²€μ¦ β†’ λ©”μ‹μ§€ λ¬΄κ²°μ„± ν™•μΈ</li>
      <li><code class="language-plaintext highlighter-rouge">EncKey</code>λ΅ μ•”νΈλ¬Έ λ³µνΈν™”</li>
    </ul>
  </li>
</ol>

<hr />

<h2 id="κµ¬ν„">κµ¬ν„</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nuxt</span> <span class="o">+</span> <span class="nx">typescript</span> <span class="nx">μ»΄ν¬μ €λΈ”</span> <span class="nx">μƒμ„±</span>

<span class="mi">1</span><span class="p">.</span> <span class="nx">base64</span> <span class="nx">ν•νƒμ</span> <span class="nx">server</span> <span class="kr">public</span> <span class="nx">key</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">form</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">μ•”νΈν™”</span> <span class="nx">λ€μƒ</span> <span class="nx">fieldλ…</span> <span class="nx">λ°°μ—΄μ„</span> <span class="nx">μ…λ ¥λ°›μ</span>
<span class="mi">1</span><span class="p">.</span> <span class="nx">form</span> <span class="nx">fieldλ”</span> <span class="nx">AES</span><span class="o">/</span><span class="nx">CBC</span><span class="o">/</span><span class="nx">PKCS5Padding</span>  <span class="nx">μ•”νΈν™”</span> <span class="nx">μ•κ³ λ¦¬μ¦</span> <span class="nx">μ΄μ©ν•μ—¬</span> <span class="nx">μ•”νΈν™”</span>
<span class="mi">1</span><span class="p">.</span> <span class="nx">AES</span> <span class="nx">Keyμ™€</span> <span class="nx">ivλ”</span> <span class="nx">EC</span><span class="o">/</span><span class="nx">secp256r1</span><span class="p">,</span> <span class="nx">ECIES</span> <span class="nx">μ•”νΈν™”</span> <span class="nx">μ•κ³ λ¦¬μ¦</span> <span class="nx">μ΄μ©ν•μ—¬</span> <span class="nx">λ§λ“¤μ–΄μ§„</span> <span class="nx">server</span> <span class="kr">public</span> <span class="nx">keyλ¥Ό</span> <span class="nx">μ΄μ©ν•μ—¬</span> <span class="nx">μ•”νΈν™”</span>
<span class="mi">1</span><span class="p">.</span> <span class="nx">java</span> <span class="nx">BouncyCastleProvider</span> <span class="nx">κ³Ό</span> <span class="nx">νΈν™</span> <span class="nx">λμ–΄μ•Όν• </span> <span class="nx">κ²ƒ</span>
<span class="mi">1</span><span class="p">.</span> <span class="nx">μ¶λ ¥μ€</span> <span class="nx">μ•”νΈν™”λ</span> <span class="nx">form</span> <span class="nx">object</span><span class="p">,</span> <span class="nx">μ•”νΈν™”</span> <span class="nx">λ</span> <span class="nx">aes</span> <span class="nx">key</span> <span class="nx">base64</span><span class="p">,</span> <span class="nx">μ•”νΈν™”</span> <span class="nx">λ</span> <span class="nx">iv</span> <span class="nx">base64κ°€</span> <span class="nx">λ‚μ™€μ•Ό</span> <span class="nx">ν•¨</span>
<span class="mi">1</span><span class="p">.</span> <span class="nx">salt</span><span class="p">,</span> <span class="nx">info</span><span class="p">,</span> <span class="nx">wrap</span> <span class="nx">λ“±</span> <span class="nx">ν•„μμ μ΄μ§€</span> <span class="nx">μ•μ€</span> <span class="nx">λ΅μ§μ€</span> <span class="nx">λ¨λ‘</span> <span class="nx">μ κ±°</span>
</code></pre></div></div>

<h3 id="μµμΆ…-κ²°μ •-μ•”νΈν™”-λ°©μ‹">μµμΆ… κ²°μ • μ•”νΈν™” λ°©μ‹</h3>

<p><strong>ECIES</strong></p>

<ul>
  <li>Curve : <code class="language-plaintext highlighter-rouge">secp256r1</code></li>
  <li>Point Encoding: <code class="language-plaintext highlighter-rouge">? (Uncompressed | Compressed | Hybrid)</code></li>
  <li>KDF: <code class="language-plaintext highlighter-rouge">KDF2 with SHA-256</code></li>
  <li>λ€μΉ­μ•”νΈν™”: <code class="language-plaintext highlighter-rouge">AES-256-CBC</code></li>
</ul>

<p><strong>AES</strong></p>

<ul>
  <li>Mode: <code class="language-plaintext highlighter-rouge">AES-256-CBC</code></li>
  <li>IV: <code class="language-plaintext highlighter-rouge">Random</code></li>
  <li>Padding: <code class="language-plaintext highlighter-rouge">PKCS5Padding</code> (PKCS7Padding νΈν™)</li>
  <li>MAC: <code class="language-plaintext highlighter-rouge">HMAC-SHA256</code></li>
</ul>

<hr />

<h3 id="design">Design</h3>

<p><img src="/assets/img/2025-08-20-ECIES-μ•”νΈν™”-μ μ©-κΈ°λ΅.md/1.png" alt="1" /><em>image.png</em></p>

<h3 id="μ†μ¤μ½”λ“">μ†μ¤μ½”λ“</h3>

<p>Server</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Empty</span>
</code></pre></div></div>

<p>Client</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Empty</span>
</code></pre></div></div>

<h2 id="λ¦¬ν©ν† λ§">λ¦¬ν©ν† λ§</h2>

<p>κΈ°μ΅΄μ—λ” Form data μ•”νΈν™”μ™€ ECIES λ‚΄λ¶€ μ•”νΈν™” λ°©μ‹μ΄ μƒμ΄ν•κ² κ°λ°λμ—μ.</p>

<p>Form data μ•”νΈν™”μ— μ‚¬μ©λλ” λ€μΉ­ μ•”νΈν™”λ¥Ό ECIES λ‚΄λ¶€μ—μ„λ„ λ™μΌν•κ² μ‚¬μ©ν•κ²λ” κ°μ„ </p>

<p>Server</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Component</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EciesUtil</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">KEY_ALGORITHM</span> <span class="o">=</span> <span class="s">"ECDH"</span><span class="o">;</span> <span class="c1">// KeyAgreement algorithm</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">KEY_FACTORY_ALG</span> <span class="o">=</span> <span class="s">"EC"</span><span class="o">;</span> <span class="c1">// KeyFactory algorithm (important!)</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">CURVE_NAME</span> <span class="o">=</span> <span class="s">"secp256r1"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">HKDF_HASH</span> <span class="o">=</span> <span class="s">"HmacSHA256"</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">AES_KEY_LEN_BYTES</span> <span class="o">=</span> <span class="mi">32</span><span class="o">;</span> <span class="c1">// 256-bit</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">SecureRandom</span> <span class="n">secureRandom</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecureRandom</span><span class="o">();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">AesUtil</span> <span class="n">aesUtil</span><span class="o">;</span> <span class="c1">// AES μ•”λ³µνΈν™” μ ν‹Έ (μ¶”μ •)</span>

    <span class="kd">public</span> <span class="nc">KeyPair</span> <span class="nf">generateECKeyPair</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">GeneralSecurityException</span> <span class="o">{</span>
        <span class="nc">KeyPairGenerator</span> <span class="n">kpg</span> <span class="o">=</span> <span class="nc">KeyPairGenerator</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="no">KEY_FACTORY_ALG</span><span class="o">);</span>
        <span class="nc">ECGenParameterSpec</span> <span class="n">ecGenParameterSpec</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ECGenParameterSpec</span><span class="o">(</span><span class="no">CURVE_NAME</span><span class="o">);</span>
        <span class="n">kpg</span><span class="o">.</span><span class="na">initialize</span><span class="o">(</span><span class="n">ecGenParameterSpec</span><span class="o">,</span> <span class="n">secureRandom</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">kpg</span><span class="o">.</span><span class="na">generateKeyPair</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Sender: recipientPublicKeyλ΅λ¶€ν„° ephemeral ν‚¤ μƒμ„± ν›„ shared secret -&gt; HKDF -&gt; aesKey μƒμ„±
     * λ°ν™κ°’μ— ephemeralPublicKey, aesKey, iv ν¬ν•¨ (ivλ” λλ¤ μƒμ„±)
     */</span>
    <span class="kd">public</span> <span class="nc">EciesSecret</span> <span class="nf">generateSecret</span><span class="o">(</span><span class="nc">PublicKey</span> <span class="n">recipientPublicKey</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">GeneralSecurityException</span> <span class="o">{</span>
        <span class="c1">// 1) ephemeral keypair μƒμ„±</span>
        <span class="nc">KeyPair</span> <span class="n">ephemeral</span> <span class="o">=</span> <span class="n">generateECKeyPair</span><span class="o">();</span>

        <span class="c1">// 2) shared secret (ephemeralPriv, recipientPub)</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">sharedSecret</span> <span class="o">=</span> <span class="n">deriveSharedSecret</span><span class="o">(</span><span class="n">ephemeral</span><span class="o">.</span><span class="na">getPrivate</span><span class="o">(),</span> <span class="n">recipientPublicKey</span><span class="o">);</span>

        <span class="c1">// 3) HKDFλ΅ AES ν‚¤ νμƒ (AES-256)</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">aesKeyBytes</span> <span class="o">=</span> <span class="n">hkdfExpand</span><span class="o">(</span><span class="n">sharedSecret</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="s">"ECIES-AES-256"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="no">AES_KEY_LEN_BYTES</span><span class="o">);</span>

        <span class="nc">SecretKey</span> <span class="n">aesKey</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">(</span><span class="n">aesKeyBytes</span><span class="o">,</span> <span class="s">"AES"</span><span class="o">);</span>

        <span class="c1">// 4) IV μƒμ„± (μ „μ†΅ ν•„μ”)</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">ivBytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">16</span><span class="o">];</span>
        <span class="n">secureRandom</span><span class="o">.</span><span class="na">nextBytes</span><span class="o">(</span><span class="n">ivBytes</span><span class="o">);</span>
        <span class="nc">IvParameterSpec</span> <span class="n">iv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IvParameterSpec</span><span class="o">(</span><span class="n">ivBytes</span><span class="o">);</span>

        <span class="k">return</span> <span class="nc">EciesSecret</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">ephemeralPublicKey</span><span class="o">(</span><span class="n">ephemeral</span><span class="o">.</span><span class="na">getPublic</span><span class="o">())</span>
                <span class="o">.</span><span class="na">aesKey</span><span class="o">(</span><span class="n">aesKey</span><span class="o">)</span>
                <span class="o">.</span><span class="na">iv</span><span class="o">(</span><span class="n">iv</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Receiver: base64λ΅ λ„μ–΄μ¨ ephemeralPublicKeyμ™€ μμ‹ μ privateKeyλ΅ shared secret μƒμ„± ν›„ λ™μΌν• HKDFλ΅ aesKey λ„μ¶
     */</span>
    <span class="kd">public</span> <span class="nc">EciesSecret</span> <span class="nf">generateSecret</span><span class="o">(</span><span class="nc">PrivateKey</span> <span class="n">recipientPrivateKey</span><span class="o">,</span> <span class="nc">String</span> <span class="n">base64EphemeralPublicKey</span><span class="o">,</span> <span class="nc">String</span> <span class="n">base64Iv</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="nc">GeneralSecurityException</span> <span class="o">{</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">ephemeralBytes</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">getDecoder</span><span class="o">().</span><span class="na">decode</span><span class="o">(</span><span class="n">base64EphemeralPublicKey</span><span class="o">);</span>
        <span class="nc">KeyFactory</span> <span class="n">kf</span> <span class="o">=</span> <span class="nc">KeyFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="no">KEY_FACTORY_ALG</span><span class="o">);</span>
        <span class="nc">PublicKey</span> <span class="n">ephemeralPub</span> <span class="o">=</span> <span class="n">kf</span><span class="o">.</span><span class="na">generatePublic</span><span class="o">(</span><span class="k">new</span> <span class="nc">X509EncodedKeySpec</span><span class="o">(</span><span class="n">ephemeralBytes</span><span class="o">));</span>

        <span class="kt">byte</span><span class="o">[]</span> <span class="n">ivBytes</span> <span class="o">=</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">getDecoder</span><span class="o">().</span><span class="na">decode</span><span class="o">(</span><span class="n">base64Iv</span><span class="o">);</span>
        <span class="nc">IvParameterSpec</span> <span class="n">iv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IvParameterSpec</span><span class="o">(</span><span class="n">ivBytes</span><span class="o">);</span>

        <span class="kt">byte</span><span class="o">[]</span> <span class="n">sharedSecret</span> <span class="o">=</span> <span class="n">deriveSharedSecret</span><span class="o">(</span><span class="n">recipientPrivateKey</span><span class="o">,</span> <span class="n">ephemeralPub</span><span class="o">);</span>

        <span class="kt">byte</span><span class="o">[]</span> <span class="n">aesKeyBytes</span> <span class="o">=</span> <span class="n">hkdfExpand</span><span class="o">(</span><span class="n">sharedSecret</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="s">"ECIES-AES-256"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="no">AES_KEY_LEN_BYTES</span><span class="o">);</span>
        <span class="nc">SecretKey</span> <span class="n">aesKey</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">(</span><span class="n">aesKeyBytes</span><span class="o">,</span> <span class="s">"AES"</span><span class="o">);</span>

        <span class="k">return</span> <span class="nc">EciesSecret</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">ephemeralPublicKey</span><span class="o">(</span><span class="n">ephemeralPub</span><span class="o">)</span>
                <span class="o">.</span><span class="na">aesKey</span><span class="o">(</span><span class="n">aesKey</span><span class="o">)</span>
                <span class="o">.</span><span class="na">iv</span><span class="o">(</span><span class="n">iv</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">deriveSharedSecret</span><span class="o">(</span><span class="nc">PrivateKey</span> <span class="n">priv</span><span class="o">,</span> <span class="nc">PublicKey</span> <span class="n">pub</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">GeneralSecurityException</span> <span class="o">{</span>
        <span class="nc">KeyAgreement</span> <span class="n">keyAgreement</span> <span class="o">=</span> <span class="nc">KeyAgreement</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="no">KEY_ALGORITHM</span><span class="o">);</span>
        <span class="n">keyAgreement</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">priv</span><span class="o">);</span>
        <span class="n">keyAgreement</span><span class="o">.</span><span class="na">doPhase</span><span class="o">(</span><span class="n">pub</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">keyAgreement</span><span class="o">.</span><span class="na">generateSecret</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// HKDF (RFC 5869) - simple extract/expand using HmacSHA256</span>
    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">hkdfExpand</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">prkOrIkm</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">salt</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">info</span><span class="o">,</span> <span class="kt">int</span> <span class="n">len</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">GeneralSecurityException</span> <span class="o">{</span>
        <span class="c1">// For simplicity: do HKDF-Extract then HKDF-Expand</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">prk</span> <span class="o">=</span> <span class="n">hkdfExtract</span><span class="o">(</span><span class="n">salt</span><span class="o">,</span> <span class="n">prkOrIkm</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">hkdfExpandFromPrk</span><span class="o">(</span><span class="n">prk</span><span class="o">,</span> <span class="n">info</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">hkdfExtract</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">salt</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">ikm</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">GeneralSecurityException</span> <span class="o">{</span>
        <span class="nc">Mac</span> <span class="n">mac</span> <span class="o">=</span> <span class="nc">Mac</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="no">HKDF_HASH</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">salt</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">salt</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">mac</span><span class="o">.</span><span class="na">getMacLength</span><span class="o">()];</span>
        <span class="o">}</span>
        <span class="nc">SecretKeySpec</span> <span class="n">keySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">(</span><span class="n">salt</span><span class="o">,</span> <span class="no">HKDF_HASH</span><span class="o">);</span>
        <span class="n">mac</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">keySpec</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">mac</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">ikm</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">hkdfExpandFromPrk</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">prk</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">info</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">GeneralSecurityException</span> <span class="o">{</span>
        <span class="nc">Mac</span> <span class="n">mac</span> <span class="o">=</span> <span class="nc">Mac</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="no">HKDF_HASH</span><span class="o">);</span>
        <span class="nc">SecretKeySpec</span> <span class="n">keySpec</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SecretKeySpec</span><span class="o">(</span><span class="n">prk</span><span class="o">,</span> <span class="no">HKDF_HASH</span><span class="o">);</span>
        <span class="n">mac</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="n">keySpec</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">hashLen</span> <span class="o">=</span> <span class="n">mac</span><span class="o">.</span><span class="na">getMacLength</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="nc">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span> <span class="n">length</span> <span class="o">/</span> <span class="n">hashLen</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="o">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">GeneralSecurityException</span><span class="o">(</span><span class="s">"Cannot expand to more than 255 * HashLen bytes with HKDF"</span><span class="o">);</span>

        <span class="kt">byte</span><span class="o">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">length</span><span class="o">];</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">copied</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">mac</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">info</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">mac</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">info</span><span class="o">);</span>
            <span class="n">mac</span><span class="o">.</span><span class="na">update</span><span class="o">((</span><span class="kt">byte</span><span class="o">)</span> <span class="n">i</span><span class="o">);</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">mac</span><span class="o">.</span><span class="na">doFinal</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">toCopy</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">length</span> <span class="o">-</span> <span class="n">copied</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">arraycopy</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">result</span><span class="o">,</span> <span class="n">copied</span><span class="o">,</span> <span class="n">toCopy</span><span class="o">);</span>
            <span class="n">copied</span> <span class="o">+=</span> <span class="n">toCopy</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// AES μ•”λ³µνΈ νΈμ¶μ€ κΈ°μ΅΄μ aesUtil μ‚¬μ©</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">encrypt</span><span class="o">(</span><span class="nc">String</span> <span class="n">data</span><span class="o">,</span> <span class="nc">EciesSecret</span> <span class="n">secret</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">aesUtil</span><span class="o">.</span><span class="na">encrypt</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">secret</span><span class="o">.</span><span class="na">getAesKey</span><span class="o">(),</span> <span class="n">secret</span><span class="o">.</span><span class="na">getIv</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">decrypt</span><span class="o">(</span><span class="nc">String</span> <span class="n">encryptedData</span><span class="o">,</span> <span class="nc">EciesSecret</span> <span class="n">secret</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">aesUtil</span><span class="o">.</span><span class="na">decrypt</span><span class="o">(</span><span class="n">encryptedData</span><span class="o">,</span> <span class="n">secret</span><span class="o">.</span><span class="na">getAesKey</span><span class="o">(),</span> <span class="n">secret</span><span class="o">.</span><span class="na">getIv</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="c1">// PostConstructλ” λ°λ¨μ©μΌλ΅λ§ μ‚¬μ©; μ΄μ ν™κ²½μ—μ„  μ κ±° κ¶μ¥</span>
    <span class="nd">@PostConstruct</span>
    <span class="kt">void</span> <span class="nf">demo</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">KeyPair</span> <span class="n">kp</span> <span class="o">=</span> <span class="n">generateECKeyPair</span><span class="o">();</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"publicKey (base64) = {}"</span><span class="o">,</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">getEncoder</span><span class="o">().</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">kp</span><span class="o">.</span><span class="na">getPublic</span><span class="o">().</span><span class="na">getEncoded</span><span class="o">()));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"EciesUtil demo error"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Client</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/** ECIES μ•”νΈν™” λΉ„λ°€ ν‚¤ μλ£κµ¬μ΅° */</span>
<span class="k">export</span> <span class="kr">interface</span> <span class="nx">EciesSecret</span> <span class="p">{</span>
  <span class="cm">/** μ„μ‹ κ³µκ°ν‚¤ */</span>
  <span class="nl">ephemeralPublicKey</span><span class="p">:</span> <span class="nx">CryptoKey</span><span class="p">;</span>
  <span class="cm">/** νμƒλ AES λ€μΉ­ν‚¤ */</span>
  <span class="nl">aesKey</span><span class="p">:</span> <span class="nx">CryptoKey</span><span class="p">;</span>
  <span class="cm">/** AES-CBC μ•”νΈν™”λ¥Ό μ„ν• μ΄κΈ°ν™” λ²΅ν„° (IV) */</span>
  <span class="nl">iv</span><span class="p">:</span> <span class="nb">Uint8Array</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="nx">type</span> <span class="nx">Base64String</span> <span class="o">=</span> <span class="nx">string</span><span class="p">;</span>

<span class="cm">/**
 * μ„λ²„ κ³µκ°ν‚¤μ™€ Form λ°μ΄ν„°λ¥Ό λ°›μ•„μ„ μ„ νƒ ν•„λ“λ¥Ό ECIES μ•”νΈν™”
 *
 * @template Form Form κ°μ²΄ νƒ€μ…
 * @param serverPublicKeyBase64 Base64 μΈμ½”λ”©λ μ„λ²„ κ³µκ°ν‚¤ (SPKI)
 * @param formData μ•”νΈν™”ν•  Form λ°μ΄ν„°
 * @param fieldsToEncrypt μ•”νΈν™”ν•  ν•„λ“ λ°°μ—΄
 * @returns μ•”νΈν™” κ²°κ³Ό κ°μ²΄
 */</span>
<span class="k">export</span> <span class="k">async</span> <span class="kd">function</span> <span class="nx">encryptFormData</span><span class="o">&lt;</span><span class="nx">Form</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="nx">serverPublicKeyBase64</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span>
  <span class="nx">formData</span><span class="p">:</span> <span class="nx">Form</span><span class="p">,</span>
  <span class="nx">fieldsToEncrypt</span><span class="p">:</span> <span class="nx">string</span><span class="p">[],</span>
<span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="p">{</span>
  <span class="na">iv</span><span class="p">:</span> <span class="nx">Base64String</span><span class="p">;</span>
  <span class="nl">ephemeralPubKey</span><span class="p">:</span> <span class="nx">Base64String</span><span class="p">;</span>
  <span class="nl">encryptedFormData</span><span class="p">:</span> <span class="nx">Form</span><span class="p">;</span>
<span class="p">}</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="c1">// μ„λ²„ κ³µκ°ν‚¤ import</span>
  <span class="kd">const</span> <span class="nx">serverPubKey</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">importKey</span><span class="p">(</span>
    <span class="dl">"</span><span class="s2">spki</span><span class="dl">"</span><span class="p">,</span>
    <span class="nb">Uint8Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">serverPublicKeyBase64</span><span class="p">),</span> <span class="nx">c</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)).</span><span class="nx">buffer</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ECDH</span><span class="dl">"</span><span class="p">,</span> <span class="na">namedCurve</span><span class="p">:</span> <span class="dl">"</span><span class="s2">P-256</span><span class="dl">"</span> <span class="p">},</span>
    <span class="kc">false</span><span class="p">,</span>
    <span class="p">[],</span>
  <span class="p">);</span>

  <span class="c1">// ECIES λΉ„λ°€ ν‚¤ μƒμ„±</span>
  <span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">generateSecret</span><span class="p">(</span><span class="nx">serverPubKey</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">ephemeralPubKey</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">exportKey</span><span class="p">(</span><span class="dl">"</span><span class="s2">spki</span><span class="dl">"</span><span class="p">,</span> <span class="nx">secret</span><span class="p">.</span><span class="nx">ephemeralPublicKey</span><span class="p">);</span>

  <span class="c1">// ν•„λ“λ³„ μ•”νΈν™”</span>
  <span class="kd">const</span> <span class="nx">encryptedFormData</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">formData</span> <span class="p">};</span>
  <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">formData</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="k">async</span> <span class="p">([</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">fieldsToEncrypt</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">encryptedFormData</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">encryptField</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">secret</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}),</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">iv</span><span class="p">:</span> <span class="nx">arrayBufferToBase64</span><span class="p">(</span><span class="nx">secret</span><span class="p">.</span><span class="nx">iv</span><span class="p">.</span><span class="nx">buffer</span> <span class="k">as</span> <span class="nb">ArrayBuffer</span><span class="p">),</span>
    <span class="na">ephemeralPubKey</span><span class="p">:</span> <span class="nx">arrayBufferToBase64</span><span class="p">(</span><span class="nx">ephemeralPubKey</span><span class="p">),</span>
    <span class="nx">encryptedFormData</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="cm">/** ArrayBuffer β†’ Base64 λ³€ν™ */</span>
<span class="kd">function</span> <span class="nx">arrayBufferToBase64</span><span class="p">(</span><span class="nx">buffer</span><span class="p">:</span> <span class="nb">ArrayBuffer</span><span class="p">):</span> <span class="nx">string</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">binary</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">buffer</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">byteLength</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">binary</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">bytes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">btoa</span><span class="p">(</span><span class="nx">binary</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/** PKCS#7 ν¨λ”© μ μ© */</span>
<span class="kd">function</span> <span class="nx">pkcs7Pad</span><span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nb">Uint8Array</span><span class="p">,</span> <span class="nx">blockSize</span><span class="p">:</span> <span class="nx">number</span> <span class="o">=</span> <span class="mi">16</span><span class="p">):</span> <span class="nb">Uint8Array</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">padLength</span> <span class="o">=</span> <span class="nx">blockSize</span> <span class="o">-</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">%</span> <span class="nx">blockSize</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">padded</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">padLength</span><span class="p">);</span>
  <span class="nx">padded</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">padded</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">padded</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">padLength</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">padded</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/** μ„λ²„ κ³µκ°ν‚¤λ΅ ECIES λΉ„λ°€ ν‚¤ μƒμ„± */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">generateSecret</span><span class="p">(</span><span class="nx">pubKey</span><span class="p">:</span> <span class="nx">CryptoKey</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">EciesSecret</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">ephemeralKeyPair</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">generateKey</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ECDH</span><span class="dl">"</span><span class="p">,</span> <span class="na">namedCurve</span><span class="p">:</span> <span class="dl">"</span><span class="s2">P-256</span><span class="dl">"</span> <span class="p">},</span> <span class="kc">true</span><span class="p">,</span> <span class="p">[</span><span class="dl">"</span><span class="s2">deriveKey</span><span class="dl">"</span><span class="p">]);</span>

  <span class="kd">const</span> <span class="nx">sharedSecret</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">deriveKey</span><span class="p">(</span>
    <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ECDH</span><span class="dl">"</span><span class="p">,</span> <span class="na">public</span><span class="p">:</span> <span class="nx">pubKey</span> <span class="p">},</span>
    <span class="nx">ephemeralKeyPair</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AES-CBC</span><span class="dl">"</span><span class="p">,</span> <span class="na">length</span><span class="p">:</span> <span class="mi">256</span> <span class="p">},</span>
    <span class="kc">true</span><span class="p">,</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">encrypt</span><span class="dl">"</span><span class="p">],</span>
  <span class="p">);</span>

  <span class="kd">const</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">getRandomValues</span><span class="p">(</span><span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="na">ephemeralPublicKey</span><span class="p">:</span> <span class="nx">ephemeralKeyPair</span><span class="p">.</span><span class="nx">publicKey</span><span class="p">,</span>
    <span class="na">aesKey</span><span class="p">:</span> <span class="nx">sharedSecret</span><span class="p">,</span>
    <span class="nx">iv</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="cm">/** λ¬Έμμ—΄ β†’ AES-CBC μ•”νΈν™” (PKCS#7 ν¬ν•¨) */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">eciesEncrypt</span><span class="p">(</span><span class="nx">source</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">secret</span><span class="p">:</span> <span class="nx">EciesSecret</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Base64String</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">plaintext</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TextEncoder</span><span class="p">().</span><span class="nx">encode</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
  <span class="nx">plaintext</span> <span class="o">=</span> <span class="nx">pkcs7Pad</span><span class="p">(</span><span class="nx">plaintext</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">ciphertext</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">crypto</span><span class="p">.</span><span class="nx">subtle</span><span class="p">.</span><span class="nx">encrypt</span><span class="p">({</span> <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">AES-CBC</span><span class="dl">"</span><span class="p">,</span> <span class="na">iv</span><span class="p">:</span> <span class="nx">secret</span><span class="p">.</span><span class="nx">iv</span> <span class="p">},</span> <span class="nx">secret</span><span class="p">.</span><span class="nx">aesKey</span><span class="p">,</span> <span class="nx">plaintext</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">arrayBufferToBase64</span><span class="p">(</span><span class="nx">ciphertext</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/** λ‹¨μΌ ν•„λ“ μ•”νΈν™” */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">encryptField</span><span class="p">(</span><span class="nx">value</span><span class="p">:</span> <span class="nx">string</span><span class="p">,</span> <span class="nx">secret</span><span class="p">:</span> <span class="nx">EciesSecret</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">Base64String</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">eciesEncrypt</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">secret</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="na">error</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">`Encryption failed for value: </span><span class="p">${</span><span class="nx">value</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Failed to encrypt field: </span><span class="p">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<hr />

<h1 id="epilogue">Epilogue</h1>

<p>ν•΄λ‹Ή μ—…λ¬΄λ¥Ό μ§„ν–‰ν•λ©° κ³Όκ±°μ— μ•„λ¬΄κ²ƒλ„ λ¨λ¥΄κ³  κ·Έλƒ¥ λ¬΄μ‘μ • μ•”κΈ°ν–λ μ•…λ½κ°™μ€ κΈ°μ λ“¤μ΄ μƒλ΅μƒλ΅ κΈ°μ–µλ‚λ©΄μ„ κµ‰μ¥ν μ‹ μ„ ν–μ.</p>

<p>Buffer μ²λ¦¬λ‚ Web Crypto API ν•Έλ“¤λ§λ„ μΆ€ λ” λ¥μ™ν•΄μ΅κ³ , κΈ°λ³Έμ μΈ μ•”νΈν™” κµ¬μ΅°λ‚ κ°λ…λ“¤κ³Όλ„ μΆ€ λ” μΉν•΄μ§„ κ²ƒ κ°™μ.</p>

<p>ν”Όμ™€ μ‚΄μ΄ λλ” κ²½ν—μ΄μ€λ κ²ƒ κ°™μβ€¦</p>

<h1 id="μ°Έκ³ ">μ°Έκ³ </h1>

<p>κµ¬ν„ Design sequence diagram</p>

<p><a href="https://prod-files-secure.s3.us-west-2.amazonaws.com/8daffe33-d95b-4c96-91e6-1b899bcdb2d7/a7e5a59a-ccb0-41b0-b7cf-f894674cfbf3/%E1%84%8C%E1%85%A6%E1%84%86%E1%85%A9%E1%86%A8_%E1%84%8B%E1%85%A5%E1%86%B9%E1%84%82%E1%85%B3%E1%86%AB_%E1%84%83%E1%85%A1%E1%84%8B%E1%85%B5%E1%84%8B%E1%85%A5%E1%84%80%E1%85%B3%E1%84%85%E1%85%A2%E1%86%B7.drawio?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&amp;X-Amz-Credential=ASIAZI2LB4666H36SVSH%2F20260109%2Fus-west-2%2Fs3%2Faws4_request&amp;X-Amz-Date=20260109T095253Z&amp;X-Amz-Expires=3600&amp;X-Amz-Security-Token=IQoJb3JpZ2luX2VjENn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIGrPHHkK4o3inqeb99fw0pmuXrtzgBs%2BiXZx%2FbDb7YIrAiEA4Z38T7d1Af%2FQ8JVX96hRy0SQiIcHTBhxZ1kqXSg2sx8qiAQIov%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDGFPuEWKJNXSF6hd4yrcAwR0j%2BGQpTkjiq8cWiePNdw%2Bf0%2BT9CuWTmTWfdT2z50uD5MHPKo%2BZTiBt79uHOyurs9lnAahC0CmqerCdfPETKyYCqSqB5PrRQeFpl%2FBMw%2Bkfx792Lfm7DzSFyqPD3rBRD4213zRgbD1TXSI%2BADZ%2FoIhY%2BSeBO9h7yBlVrRLeJl0MMo1tO38MgrSDvEWvqCu%2FVknSxtt9iU3OVNt6iW%2Fo1vqAvpTeFOLvH9t1GdoKJTii3BwQ%2B0GdY4ZYXl0hcw%2FDvKGeAqY4YmJGiLnEbC3waHG74X49rzfxqkjUuJyLPtqwntJB34Ibj5u%2BCm5x2qunXTQnQuqfzbgHg8wI0O8nSt1DgfsvPaYZTzpxVWwBfmVT3GOf6ATNn2fO%2FRpdIxjqYL%2FskLN7ldjG%2FcBnIfnqpClXHkunQeV6WtiJaEfqQhAJlEIBRpp8jofvR3TbpDtnhd%2B6V6ELZx%2BH%2FABWxbskCC463gisTjAhdyynetwHtDS9SnVbFxC4GfSCXhVtSQ5zaQjuqL%2FLJ2XZIMoggCpSYcb6FOH7bzo4jOwQHHrk94B25de06tUM0k0kVbkJfqJDClSb2VDwPOQq46BwmZ3hBhqn2Qn4I4DTjODGpTjtxzTqtCRenLEXilwDEa5MO%2BLg8sGOqUBRfoHZROocam2b2TCBsW21cbQP4rDDTVyflGH1qXkPtzSAY9yjivMN1debrIzi0BQ3lYAbpzL6WGFXSdc50QA3iFVkmRmXcGrJ78H07Ai%2FZb1p2OgxOuK%2FYCa5OW4owdjFag2xu0MDYoqBcayEwvk2piW2oDqOaeOgxJnOeS6KsjxbPx3sxDSfj41%2B67UrSb9I8pZN0KBSARFfkCX7S3Uc%2BYdWndl&amp;X-Amz-Signature=c1b1b85b8e9ea23827a39106d7f90bce8c5eb5c35cdb787af192e358140735cb&amp;X-Amz-SignedHeaders=host&amp;x-amz-checksum-mode=ENABLED&amp;x-id=GetObject">file</a></p>


  </div>

  <div class="c-article__comment">
    <script src="https://utteranc.es/client.js"
        repo="croot-dev/croot-dev.github.io"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
  </div>


  <!-- Previous / Next Buttons -->
  <div class="pagenav">
    
    <div class="wrapper" id="left">
      <small><b>Previous</b> Aug 5, 2025</small>
      <br>
      <a class="no-hov" href="/%EA%B8%B0%EC%88%A0/2025/08/05/%EB%B6%84%EC%82%B0-%ED%99%98%EA%B2%BD-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98-%EC%A0%95%EB%A6%AC/">&laquo; π“¦ λ¶„μ‚° ν™κ²½ μ•κ³ λ¦¬μ¦ μ •λ¦¬</a>
    </div>
    
    
    <div class="wrapper" id="right">
      <small>Nov 11, 2025 <b>Next</b></small>
      <br>
      <a class="no-hov" href="/%EC%B7%A8%EB%AF%B8/2025/11/11/Gartner-2026/">Gartner 2026 &raquo;</a>
    </div>
    
  </div>
  <!-- Disqus comments view -->
  
</article>

  </div>
  <footer class="c-page__footer">
  <p>&copy; croot-dev.github.io 2026</p>
  <p><a href="https://github.com/croot-dev">Github</a></p>
</footer>

</div>

    </main>
    
  </body>
</html>
